# 地图工具栏功能说明

## 功能概览

新增的地图工具栏（MapToolbar）提供了以下强大功能，参考了 OLTB (OpenLayers Toolbar) 项目的设计理念：

## 🎨 1. 绘制工具

### 支持的图形类型：
- **点 (Point)**: 在地图上标记单个位置
- **线 (LineString)**: 绘制路径或线段
- **面 (Polygon)**: 绘制区域或多边形

### 使用方法：
1. 点击对应的绘制按钮（点/线/面）
2. 在地图上点击开始绘制
3. 双击完成绘制
4. 绘制的图形会保存在独立的图层中

### 样式特点：
- 绿色填充和描边 (#4CAF50)
- 半透明效果，不遮挡底图
- 所有绘制内容在专用图层，层级为 100

## 📏 2. 测量工具

### 测量类型：
- **距离测量**: 测量两点或多点之间的实际距离
  - 小于 1000m 显示为米（m）
  - 大于 1000m 显示为千米（km）
  
- **面积测量**: 测量封闭区域的实际面积
  - 小于 10000m² 显示为平方米（m²）
  - 大于 10000m² 显示为平方千米（km²）

### 使用方法：
1. 点击"距离"或"面积"按钮
2. 在地图上点击起点
3. 继续点击中间点（距离）或围成封闭区域（面积）
4. 双击结束测量
5. 测量结果会实时显示在线段/区域上方

### 样式特点：
- 蓝色虚线描边 (#2196F3)
- 测量数值自动跟随几何图形显示
- 独立图层，层级为 101

## 🔖 3. 书签功能

### 功能说明：
保存并快速跳转到地图的特定位置和缩放级别

### 使用方法：
1. 点击"添加书签"按钮
2. 输入书签名称（可自定义）
3. 当前视图（中心点+缩放级别）被保存
4. 点击书签列表中的任意书签即可快速跳转

### 数据持久化：
- 书签保存在浏览器 localStorage
- 刷新页面后书签依然存在
- 可以删除不需要的书签

## 🗺️ 4. 自定义图层

### 功能说明：
上传并显示自定义的 GeoJSON 数据

### 支持格式：
- `.geojson`
- `.json`（符合 GeoJSON 规范）

### 使用方法：
1. 点击"上传 GeoJSON"按钮
2. 点击"选择文件"
3. 选择本地 GeoJSON 文件
4. 文件自动解析并显示在地图上
5. 地图自动缩放到图层范围

### 图层管理：
- 可以勾选/取消勾选来显示/隐藏图层
- 可以删除不需要的自定义图层
- 每个图层使用橙色样式 (#FF9800) 以区分

### 样式特点：
- 橙色描边和填充
- 半透明效果
- 层级为 50，在基础图层之上，工具图层之下

## 🧹 5. 清除功能

### 两个独立的清除按钮：

1. **清除绘制**: 删除所有绘制的点、线、面
2. **清除测量**: 删除所有测量结果

### 安全机制：
- 点击清除按钮会弹出确认对话框
- 防止误操作导致数据丢失

## 🎛️ 工具栏特性

### UI/UX 设计：
- **可折叠**: 点击顶部按钮折叠/展开工具栏
- **固定位置**: 右上角悬浮显示，不遮挡地图内容
- **响应式**: 自适应屏幕大小
- **毛玻璃效果**: 半透明背景，融入整体设计
- **滚动条**: 内容过多时可滚动

### 视觉反馈：
- **激活状态**: 当前使用的工具高亮显示（绿色渐变）
- **悬停效果**: 鼠标悬停时按钮上浮
- **颜色编码**: 
  - 绘制工具：绿色系
  - 测量工具：绿色系
  - 书签：蓝色系
  - 自定义图层：橙色系
  - 危险操作（清除）：红色系

## 📍 集成位置

工具栏已集成到两个页面：
1. **绿道总览页** (`GreenwayOverview.vue`)
2. **温榆河详情页** (`WenyuDetail.vue`)

## 🔧 技术实现

### 核心依赖：
- OpenLayers Draw 交互
- OpenLayers Sphere 测量工具
- GeoJSON 格式解析
- localStorage 数据持久化

### 代码结构：
```
MapToolbar.vue
├── 绘制工具 (Draw Interaction)
├── 测量工具 (Measure + Sphere)
├── 书签管理 (localStorage)
├── 图层上传 (GeoJSON Parser)
└── 样式系统 (OpenLayers Style)
```

## 💡 使用建议

1. **绘制前规划**: 先确定要绘制的内容，避免频繁切换工具
2. **测量精度**: 基于球面几何计算，适合大尺度测量
3. **书签命名**: 使用有意义的名称，便于后续管理
4. **GeoJSON 格式**: 确保上传的文件符合标准 GeoJSON 规范
5. **定期清理**: 不需要的绘制和测量及时清除，保持地图整洁

## 🎨 自定义样式

如需修改工具栏样式，可在 `MapToolbar.vue` 的 `<style>` 部分调整：
- 工具栏位置：修改 `.map-toolbar` 的 `top` 和 `right`
- 颜色主题：修改各按钮的 `background` 和 `border-color`
- 工具栏宽度：修改 `.map-toolbar` 的 `width`

## 🚀 未来扩展

可以继续添加的功能：
- [ ] 编辑已绘制的图形
- [ ] 保存/导出绘制结果为 GeoJSON
- [ ] 多种绘制样式选择
- [ ] 图层透明度调整
- [ ] 打印/截图功能
- [ ] 坐标查询工具
- [ ] 缓冲区分析
- [ ] 路径规划

---

**参考项目**: OLTB (OpenLayers Toolbar) - https://github.com/qulle/oltb
